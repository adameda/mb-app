{% extends "base.html" %}

{% block title %}Dashboard - MB App{% endblock %}

{% block content %}
<div class="py-10">
    <header class="mb-8 animate-fade-in">
        <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
            <h1
                class="text-4xl font-bold leading-tight tracking-tight bg-gradient-to-r from-primary via-accent to-secondary bg-clip-text text-transparent">
                Dashboard</h1>
            <p class="mt-2 text-sm text-gray-600">Vue d'ensemble de votre activité</p>
        </div>
    </header>

    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <!-- Statistiques -->
        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 mb-8 animate-scale-in">
            <!-- Card Clients -->
            <div class="card-lift overflow-hidden rounded-xl bg-white shadow-lg border border-gray-100">
                <div class="p-6">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div
                                class="rounded-xl bg-gradient-to-br from-primary to-blue-600 p-3 shadow-lg shadow-primary/30">
                                <svg class="h-7 w-7 text-white" fill="none" viewBox="0 0 24 24" stroke-width="2"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" />
                                </svg>
                            </div>
                        </div>
                        <div class="ml-5 w-0 flex-1">
                            <dl>
                                <dt class="truncate text-sm font-medium text-gray-500">Clients</dt>
                                <dd class="flex items-baseline">
                                    <div class="text-3xl font-bold text-gray-900">{{ nb_clients }}</div>
                                </dd>
                            </dl>
                        </div>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-gray-50 to-blue-50 px-6 py-3 border-t border-gray-100">
                    <a href="{{ url_for('clients_liste') }}"
                        class="border-animate text-sm font-semibold text-primary hover:text-primary/80 inline-flex items-center gap-2 group">
                        <span>Voir tous les clients</span>
                        <svg class="h-4 w-4 group-hover:translate-x-1 transition-transform" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </a>
                </div>
            </div>

            <!-- Card Devis -->
            <div class="card-lift overflow-hidden rounded-xl bg-white shadow-lg border border-gray-100">
                <div class="p-6">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div
                                class="rounded-xl bg-gradient-to-br from-accent to-red-600 p-3 shadow-lg shadow-accent/30">
                                <svg class="h-7 w-7 text-white" fill="none" viewBox="0 0 24 24" stroke-width="2"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                                </svg>
                            </div>
                        </div>
                        <div class="ml-5 w-0 flex-1">
                            <dl>
                                <dt class="truncate text-sm font-medium text-gray-500">Devis</dt>
                                <dd class="flex items-baseline">
                                    <div class="text-3xl font-bold text-gray-900">{{ nb_devis }}</div>
                                </dd>
                            </dl>
                        </div>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-gray-50 to-red-50 px-6 py-3 border-t border-gray-100">
                    <a href="{{ url_for('devis_liste') }}"
                        class="border-animate text-sm font-semibold text-accent hover:text-accent/80 inline-flex items-center gap-2 group">
                        <span>Voir tous les devis</span>
                        <svg class="h-4 w-4 group-hover:translate-x-1 transition-transform" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </a>
                </div>
            </div>

            <!-- Card Factures -->
            <div class="card-lift overflow-hidden rounded-xl bg-white shadow-lg border border-gray-100">
                <div class="p-6">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div
                                class="rounded-xl bg-gradient-to-br from-secondary to-gray-900 p-3 shadow-lg shadow-secondary/30">
                                <svg class="h-7 w-7 text-white" fill="none" viewBox="0 0 24 24" stroke-width="2"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z" />
                                </svg>
                            </div>
                        </div>
                        <div class="ml-5 w-0 flex-1">
                            <dl>
                                <dt class="truncate text-sm font-medium text-gray-500">Factures</dt>
                                <dd class="flex items-baseline">
                                    <div class="text-3xl font-bold text-gray-900">{{ nb_factures }}</div>
                                </dd>
                            </dl>
                        </div>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-gray-50 to-gray-100 px-6 py-3 border-t border-gray-100">
                    <a href="{{ url_for('factures_liste') }}"
                        class="border-animate text-sm font-semibold text-secondary hover:text-gray-700 inline-flex items-center gap-2 group">
                        <span>Voir toutes les factures</span>
                        <svg class="h-4 w-4 group-hover:translate-x-1 transition-transform" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </a>
                </div>
            </div>
        </div>

        <!-- Actions rapides -->
        <div class="mb-8 animate-scale-in">
            <h2 class="text-2xl font-bold bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent mb-4">
                Actions rapides</h2>
            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4">
                <a href="{{ url_for('devis_nouveau') }}"
                    class="card-lift relative rounded-xl border-2 border-gray-200 bg-white px-6 py-5 shadow-md hover:border-accent hover:shadow-xl transition-all">
                    <div class="flex items-center space-x-3">
                        <div class="flex-shrink-0">
                            <div class="rounded-lg bg-gradient-to-br from-accent to-red-600 p-3 shadow-lg">
                                <svg class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke-width="2"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                                </svg>
                            </div>
                        </div>
                        <div class="min-w-0 flex-1">
                            <span class="absolute inset-0" aria-hidden="true"></span>
                            <p class="text-sm font-semibold text-gray-900">Nouveau devis</p>
                            <p class="text-xs text-gray-500 mt-1">Créer un devis</p>
                        </div>
                    </div>
                </a>

                <a href="{{ url_for('factures_liste') }}"
                    class="card-lift relative rounded-xl border-2 border-gray-200 bg-white px-6 py-5 shadow-md hover:border-primary hover:shadow-xl transition-all">
                    <div class="flex items-center space-x-3">
                        <div class="flex-shrink-0">
                            <div class="rounded-lg bg-gradient-to-br from-primary to-blue-600 p-3 shadow-lg">
                                <svg class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke-width="2"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z" />
                                </svg>
                            </div>
                        </div>
                        <div class="min-w-0 flex-1">
                            <span class="absolute inset-0" aria-hidden="true"></span>
                            <p class="text-sm font-semibold text-gray-900">Voir les factures</p>
                            <p class="text-xs text-gray-500 mt-1">Consulter</p>
                        </div>
                    </div>
                </a>

                <a href="{{ url_for('client_ajouter') }}"
                    class="card-lift relative rounded-xl border-2 border-gray-200 bg-white px-6 py-5 shadow-md hover:border-secondary hover:shadow-xl transition-all">
                    <div class="flex items-center space-x-3">
                        <div class="flex-shrink-0">
                            <div class="rounded-lg bg-gradient-to-br from-secondary to-gray-900 p-3 shadow-lg">
                                <svg class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke-width="2"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                                </svg>
                            </div>
                        </div>
                        <div class="min-w-0 flex-1">
                            <span class="absolute inset-0" aria-hidden="true"></span>
                            <p class="text-sm font-semibold text-gray-900">Ajouter un client</p>
                            <p class="text-xs text-gray-500 mt-1">Nouveau client</p>
                        </div>
                    </div>
                </a>

                <a href="{{ url_for('prix_liste') }}"
                    class="card-lift relative rounded-xl border-2 border-gray-200 bg-white px-6 py-5 shadow-md hover:border-warning hover:shadow-xl transition-all">
                    <div class="flex items-center space-x-3">
                        <div class="flex-shrink-0">
                            <div class="rounded-lg bg-gradient-to-br from-warning to-orange-600 p-3 shadow-lg">
                                <svg class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke-width="2"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M14.25 7.756a4.5 4.5 0 100 8.488M7.5 10.5h5.25m-5.25 3h5.25M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                        </div>
                        <div class="min-w-0 flex-1">
                            <span class="absolute inset-0" aria-hidden="true"></span>
                            <p class="text-sm font-semibold text-gray-900">Gérer les prix</p>
                            <p class="text-xs text-gray-500 mt-1">Catalogue</p>
                        </div>
                    </div>
                </a>
            </div>
        </div>

        <!-- Derniers devis -->
        <div class="animate-scale-in">
            <div class="sm:flex sm:items-center mb-4">
                <div class="sm:flex-auto">
                    <h2
                        class="text-2xl font-bold bg-gradient-to-r from-accent to-primary bg-clip-text text-transparent">
                        Derniers devis</h2>
                </div>
            </div>
            <div class="overflow-hidden shadow-lg ring-1 ring-black ring-opacity-5 rounded-xl">
                <table class="min-w-full divide-y divide-gray-300 bg-white">
                    <thead class="bg-gradient-to-r from-gray-50 to-blue-50">
                        <tr>
                            <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900">N°
                                Devis</th>
                            <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Date</th>
                            <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Client
                            </th>
                            <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Montant
                                TTC</th>
                            <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Statut
                            </th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        {% if derniers_devis %}
                        {% for devis in derniers_devis %}
                        <tr>
                            <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900">{{
                                devis.numero }}</td>
                            <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">{{
                                devis.date.strftime('%d/%m/%Y') }}</td>
                            <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">{{ devis.client.nom }}</td>
                            <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">{{
                                "%.2f"|format(devis.total_ttc) }} €</td>
                            <td class="whitespace-nowrap px-3 py-4 text-sm">
                                <span class="inline-flex rounded-full px-2 text-xs font-semibold leading-5
                                        {% if devis.statut == 'accepte' %}bg-green-100 text-green-800
                                        {% elif devis.statut == 'refuse' %}bg-red-100 text-red-800
                                        {% elif devis.statut == 'envoye' %}bg-blue-100 text-blue-800
                                        {% else %}bg-gray-100 text-gray-800{% endif %}">
                                    {% if devis.statut == 'accepte' %}Accepté
                                    {% elif devis.statut == 'refuse' %}Refusé
                                    {% elif devis.statut == 'envoye' %}Envoyé
                                    {% elif devis.statut == 'brouillon' %}Brouillon
                                    {% else %}{{ devis.statut }}{% endif %}
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                        {% else %}
                        <tr>
                            <td colspan="5" class="px-3 py-8 text-center text-sm text-gray-500">
                                Aucun devis pour le moment. Créez votre premier devis !
                            </td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
</div>
{% endblock %}